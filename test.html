<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    
<div>
    <div>名前: <input type="text" id="uname"> </div>
    <div>
        <textarea  id="text" cols="30" rows="10"></textarea>
        <button id="send">送信</button>
        <input type="file" value="upload" id="fileButton">
    

        <img src="" alt="">
<!-- カード -->

<div class="display">
    <div class="field">
        <div id="output">
            
        </div>
    </div>
</div>

<button id="btn">test</button>


    <!-- The core Firebase JS SDK is always required and must be listed first  -->
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase.js"></script>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- JQuery -->


<script>
/*****************************************************************************************
* firebase設定
* 
* 
******************************************************************************************/
var firebaseConfig = {
    apiKey: "AIzaSyCmdOMPI8XDQg_jpLCFnw7SCJBQ0rx2XNQ",
    authDomain: "gsdemo-15532.firebaseapp.com",
    databaseURL: "https://gsdemo-15532.firebaseio.com",
    projectId: "gsdemo-15532",
    storageBucket: "gsdemo-15532.appspot.com",
    messagingSenderId: "45049544375",
    appId: "1:45049544375:web:6df75ca8a1d90ab9711732"
  };
// Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
// Get a reference to the storage service, which is used to create references in your storage bucket
    var storage = firebase.storage();
// Create a storage reference from our storage service
var storageRef = storage.ref();




    
    let fileButton = document.querySelector("#fileButton")

/*****************************************************************************************
* 
* 
* firebase設定
******************************************************************************************/

/*****************************************************************************************
 * ファイルのURL取得
 * 
 * 
******************************************************************************************/




/*****************************************************************************************
 * 
 * 
 * ファイルのURL取得
******************************************************************************************/
//非同期処理


let hako;
const test = function(){
    console.log(hako);
}

$("#btn").on("click",function(){
    setTimeout(hako = 1,1000);
    
    test();
})










    /*****************************************************************************************
     * ファイルの送信
     * 
     * 
    ******************************************************************************************/

    fileButton.addEventListener("change",function(e){   //ファイルを選択→送信でput〇
       
        $("#send").on("click",function(){
            
        //ファイルを取得
        let file = e.target.files[0];
        //storage ref を作成  //ファイルのアップロード
         firebase.storage().ref('test1/' ).child(file.name).put(file).then(snapshot => {
             const url = snapshot.ref.getDownloadURL();
             console.log(url);
    
         });
    });

     /**************************************************************************************
     *
     * 
     *  ファイルの送信
    ********************************************************************************************/
      
        
    });




    let url;
//  ボタン送信
    fileButton.addEventListener("change",function(e){   //ファイルを選択→送信でput〇
        console.log(e)
    $("#send").on("click",function(){
    //画像うｐ
    //ファイル名を取得
    let file = e.target.files[0];
    //storage ref を作成 //ファイルのアップロード
    let storageRef = firebase.storage().ref('shon/').child(file.name).put(file).then(snapshot => {
        let url = snapshot.ref.getDownloadURL();
        console.log(url);
        pushDB();
    });

        });
    });

    
//DBに送信の関数（pushFun）
  function pushDB(){ 
    const imgUrl = url;
    const uname = $("#uname").val();
    const text = $("#text").val();
            let now = new Date();  //Time取得
            let timeH = now.getHours();     //時間
            let timeM = now.getMinutes();      //分
                if(timeH<10){timeH ="0" + timeH}     //数字が一桁の場合０をつける。
                if(timeM<10){timeM ="0" + timeM}
    const time = `${timeH}:${timeM}`;         //時間：分を"time"に入れる
        
     const msg = {
        imgUrl: imgUrl, 
        uname: uname,
        text: text,
        time: time
    };
    refText.push(msg);
    
    
}



    
   



</script>
</body>
</html>