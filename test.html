<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/test.css">
    <title>Document</title>
</head>
 <body>


<div class="container">
    <div class="row">
        <div class="box1 col-12">
            box1
        </div>
    </div>
</div>


    <div class="container">
        <div class="row">
            <div class="box2 col-12">
                
                <div class="row  row-cols-md-2">
                    <div class="col mb-4">
                        <div class="card">
                           <img src="img/1.jpg" class="card-img-top" alt="">
                        <div class="card-body">
                           <h5 class="card-title">${dataUname}</h5>
                           <p class="card-text">${dataText}</p>
                           <p class="card-text"><small class="text-muted">${dataTime}</small></p>   
                        </div>
                        </div>
                        </div> 

                    


                    <div class="col mb-4">
                    <div class="card">
                        <img src="img/r.jpg" class="card-img-top" alt="...">
                    <div class="card-body">
                          <h5 class="card-title">Card title</h5>
                          <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    </div>
                    </div>
                    </div>


                    <div class="col mb-4">
                      <div class="card">

                        <img src="img/3.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h5 class="card-title">Card title</h5>
                          <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content.</p>
                        </div>
                      </div>
                    </div>


                    <div class="col mb-4">
                      <div class="card">

                        <img src="img/1.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h5 class="card-title">Card title</h5>
                          <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        </div>
                      </div>
                    </div>
                  </div>
    


                

                
            </div>
        </div>


</div>

     <!--
    <div class="container">
        <div class="row">
            <div class="col-sm">
                One of three columns
              </div>
              <div class="col-sm">
                One of three columns
              </div>
              <div class="col-sm">
                One of three columns
              </div>
        </div>
        <title>Hello, world!</title>
  </head>
  <body>
    <h1>Hello, world!</h1>
    
    </div>
    
<div>
    <div>名前: <input type="text" id="uname"> </div>
    <div>
        <textarea  id="text" cols="30" rows="10"></textarea>
        <button id="send">送信</button>
        <input type="file" value="upload" id="fileButton">
    

        <img src="" alt="">
 <!-- カード  -->

<!-- <div class="display">
    <div class="field">
        <div id="output">
            
        </div>
    </div>
</div>

<button id="btn">test</button> --> 


    <!-- The core Firebase JS SDK is always required and must be listed first  -->
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase.js"></script>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- JQuery -->

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
   
<script>
/*****************************************************************************************
* firebase設定
* 
* 
******************************************************************************************/
var firebaseConfig = {
    apiKey: "AIzaSyCmdOMPI8XDQg_jpLCFnw7SCJBQ0rx2XNQ",
    authDomain: "gsdemo-15532.firebaseapp.com",
    databaseURL: "https://gsdemo-15532.firebaseio.com",
    projectId: "gsdemo-15532",
    storageBucket: "gsdemo-15532.appspot.com",
    messagingSenderId: "45049544375",
    appId: "1:45049544375:web:6df75ca8a1d90ab9711732"
  };
// Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
// Get a reference to the storage service, which is used to create references in your storage bucket
    var storage = firebase.storage();
// Create a storage reference from our storage service
var storageRef = storage.ref();




    
    let fileButton = document.querySelector("#fileButton")

/*****************************************************************************************
* 
* 
* firebase設定
******************************************************************************************/

/*****************************************************************************************
 * ファイルのURL取得
 * 
 * 
******************************************************************************************/




/*****************************************************************************************
 * 
 * 
 * ファイルのURL取得
******************************************************************************************/
//非同期処理


let hako;
const test = function(){
    console.log(hako);
}

$("#btn").on("click",function(){
    setTimeout(hako = 1,1000);
    
    test();
})










    /*****************************************************************************************
     * ファイルの送信
     * 
     * 
    ******************************************************************************************/

    fileButton.addEventListener("change",function(e){   //ファイルを選択→送信でput〇
       
        $("#send").on("click",function(){
            
        //ファイルを取得
        let file = e.target.files[0];
        //storage ref を作成  //ファイルのアップロード
         firebase.storage().ref('test1/' ).child(file.name).put(file).then(snapshot => {
             const url = snapshot.ref.getDownloadURL();
             console.log(url);
    
         });
    });

     /**************************************************************************************
     *
     * 
     *  ファイルの送信
    ********************************************************************************************/
      
        
    });



//  Ctrl+Enter送信
fileButton.addEventListener("change",function(e){   //ファイルを選択→送信でput〇
    $("#text").on("keydown",function(e){
    if(e.ctrlKey && e.keyCode==13){
        //画像うｐ
    //ファイル名を取得
    let file = e.target.files[0];
    //storage ref を作成 //ファイルのアップロード
    let storageRef = firebase.storage().ref('shon_wolrd/').child(file.name).put(file).then(snapshot => {
        let url = snapshot.ref.getDownloadURL().then(url =>{
            const imgUrl = url;
    const uname = $("#uname").val();
    const text = $("#text").val();
            let now = new Date();  //Time取得
            let timeH = now.getHours();     //時間
            let timeM = now.getMinutes();      //分
                if(timeH<10){timeH ="0" + timeH}     //数字が一桁の場合０をつける。
                if(timeM<10){timeM ="0" + timeM}
    const time = `${timeH}:${timeM}`;         //時間：分を"time"に入れる
        
     const msg = {
        imgUrl: imgUrl, 
        uname: uname,
        text: text,
        time: time
    };
    refText.push(msg);
        }
           
        );
    });
    
    }
        });
    });



    
   



</script>
</body>
</html>